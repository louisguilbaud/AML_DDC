<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Response</title>
</head>
<body>
    <h1>API Response</h1>
    <div id="response"></div>
    <h2>Current Alerting Event Details</h2>
    <div id="currentAlertingEventResponse"></div>
    <h2>Transaction Details</h2>
    <div id="transactionDetails"></div>
    <h2>PTY Details</h2>
    <div id="ptyDetails"></div>
    <h1>Scenario Descriptions and Messages</h1>
    <div id="content"></div>

    <script>
        const token = 'eyJhbGciOiJSUzI1NiIsImprdSI6Imh0dHBzOi8vbG9jYWxob3N0L1NBU0xvZ29uL3Rva2VuX2tleXMiLCJraWQiOiJsZWdhY3ktdG9rZW4ta2V5IiwidHlwIjoiSldUIn0.eyJqdGkiOiI4NmY5YTdkMzA4Zjc0NTVkYmE4YzI5NTZmNDFlMGFlZiIsImF1dGhvcml0aWVzIjpbImNzX2ludGVybmFsX2RiX2FjY2VzcyIsInN2aXVzcnMiLCJjc19hbWxfZW1wbG95ZWVfYWNjZXNzIiwiY3NfYW1sX3NjZW5hcmlvX2FuYWx5c3QiLCJjc19lZmlsZXJfZGJfYWNjZXNzIiwiY3NfYW1sX2FkbWluaXN0cmF0b3IiLCJjc19pbnZlc3RpZ2F0b3JfZGJfYWNjZXNzX2VtcCIsImNzX2ludmVzdGlnYXRvcl9kYl9hY2Nlc3MiLCJjc19hbWxfdG1fc3RyYXRfYWNjZXNzIiwiY3NfYW1sX3FhX2FuYWx5c3QiLCJjc19hbWxfYXVkaXRvciIsInN2aWFkbXMiLCJjc19zY2VuYXJpb19hZG1pbmlzdHJhdG9yX2RiX2FjY2VzcyIsImNzX2FtbF9vcGVyYXRpb25zX21hbmFnZXIiLCJjc19jZGRfY3JyX2dyb3VwIiwic3ZpYXVkdCIsImNzX2FtbF9hbmFseXN0IiwiY3NfYW1sX2VmaWxlciIsImNzX2NkZF9oaWdoX3Jpc2tfY3VzdF9zdHJhdF9hY2Nlc3MiLCJjc19jZGRfbWVkaXVtX3Jpc2tfY3VzdF9zdHJhdF9hY2Nlc3MiLCJjc19hbWxfc2NlbmFyaW9fYWRtaW5pc3RyYXRvciIsImNzX2NkZF9hbmFseXN0IiwiY3NfYW1sX2ludmVzdGlnYXRvciIsImNzX2FtbF9kYl9hY2Nlc3MiLCJjc19hbWxfd2xfc3RyYXRfYWNjZXNzIiwiY3NfYW1sX21hbmFnZXIiLCJjc19hbWxldGxfZGJfYWNjZXNzX2VtcCIsInZzZGRuZ3MiLCJTQVNBZG1pbmlzdHJhdG9ycyIsImNzX2NkZF9wcm9tb3RlZF90b19lZGRfc3RyYXRfYWNjZXNzIiwiY3NfYmF0Y2hfZGJfYWNjZXNzX2VtcCIsImNzX2NkZF9sb3dfcmlza19jdXN0X3N0cmF0X2FjY2VzcyIsImNzX2ludGVybmFsX2RiX2FjY2Vzc19lbXAiLCJjc19lZmlsZXJfZGJfYWNjZXNzX2VtcCIsImNzX2FtbF90bV9ncm91cCJdLCJleHRfaWQiOiJ1aWQ9dml5YWFkbWluLG91PVBlb3BsZSxkYz1zYXMsZGM9Y29tIiwic3ViIjoiM2MwZTlkNjItNTY4MC00Y2UzLThjZTAtM2U4ZTE0MjFjZDZlIiwic2NvcGUiOlsiY2xpZW50cy5yZWFkIiwiY2xpZW50cy5zZWNyZXQiLCJ1YWEucmVzb3VyY2UiLCJvcGVuaWQiLCJ1YWEuYWRtaW4iLCJjbGllbnRzLmFkbWluIiwic2NpbS5yZWFkIiwidWFhLnVzZXIiLCJTQVNBZG1pbmlzdHJhdG9ycyIsImNsaWVudHMud3JpdGUiLCJzY2ltLndyaXRlIl0sImNsaWVudF9pZCI6InNhcy5lYyIsImNpZCI6InNhcy5lYyIsImF6cCI6InNhcy5lYyIsImdyYW50X3R5cGUiOiJwYXNzd29yZCIsInVzZXJfaWQiOiIzYzBlOWQ2Mi01NjgwLTRjZTMtOGNlMC0zZThlMTQyMWNkNmUiLCJvcmlnaW4iOiJsZGFwIiwidXNlcl9uYW1lIjoidml5YWFkbWluIiwiZW1haWwiOiJ2aXlhYWRtaW5AdXNlci5mcm9tLmxkYXAuY2YiLCJhdXRoX3RpbWUiOjE3MjE4OTQwMjEsInJldl9zaWciOiI0OWY2YmIwNyIsImlhdCI6MTcyMTg5NDAyMSwiZXhwIjoxNzIxODk3NjIxLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0L1NBU0xvZ29uL29hdXRoL3Rva2VuIiwiemlkIjoidWFhIiwiYXVkIjpbInNjaW0iLCJjbGllbnRzIiwidWFhIiwib3BlbmlkIiwic2FzLmVjIl19.RtctI82H_kjKQ_vJ5e6cF3b1d_bWwHDDIqCOA-nGErWW4IlJ96mFLnsGmbX7Hdjo5XYl2UFDywn3uTE-p7PO3s5nSkAbnLXn7d6ZChrBlv6pJ-_RbGdMtNn8XvDi33fSwLiLibjP1kTCnA1PbE6ZEkks3H951IHMfT8QWgypL_WX5-fuM5zCrPMxucjdOFQXUgAodMqkY0ljby4u0azSqxBsgjZY9tJjw_nhGABq2i5MVsLhncBD48FaKwZhfRRM7Nve_47WYDuspO7aGyv6oSL3tk3Mu1MTdtzRr0011QFHpiDX56gBG8cVKgo-IusCIzn_ikm35nSY1y8l3zHxZQ'
const cookie = 'sas-ingress-nginx=065cb3791bb3583f0df2865f6eeb8a3a|f0e9e5d83f1b459459b54939af4feb2b';

        const myHeaders = new Headers();
        
        myHeaders.append("Cookie", cookie);

        const requestOptions = {
            method: 'GET',
            headers: myHeaders,
            redirect: 'follow'
        };

        async function fetchInitialApiResponse() {
            const url = 'https://sasserver.demo.sas.com/svi-alert/alerts/b63203ba-d218-410d-b3fe-95108afb5208';

            try {
                const response = await fetch(url, requestOptions);
                if (!response.ok) throw new Error('Network response was not ok ' + response.statusText);
                
                const result = await response.json();
                displayResponse('response', result);

                const currentAlertingEventId = result.currentAlertingEventId;
                const actionableEntityId = result.actionableEntityId;

                console.log('Current Alerting Event ID:', currentAlertingEventId);
                console.log('Actionable Entity ID:', actionableEntityId);

                fetchCurrentAlertingEvent(currentAlertingEventId);
                fetchTransactionDetails(actionableEntityId);
                fetchPtyDetails(actionableEntityId);

                const scenarioFiredEvents = result.scenarioFiredEvents.map(event => ({
                    scenarioDescription: event.scenarioDescription,
                    messageTemplateText: event.messageTemplateText
                }));

                displayResult(scenarioFiredEvents);
            } catch (error) {
                console.error('There has been a problem with your fetch operation:', error);
            }
        }

        function displayResponse(id, result) {
            const div = document.getElementById(id);
            div.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
        }

        function displayResult(result) {
            const contentDiv = document.getElementById('content');
            result.forEach(item => {
                const scenarioDescription = document.createElement('p');
                scenarioDescription.innerText = `Scenario Description: ${item.scenarioDescription}`;
                contentDiv.appendChild(scenarioDescription);

                const messageTemplateText = document.createElement('p');
                messageTemplateText.innerText = `Message Template Text: ${item.messageTemplateText}`;
                contentDiv.appendChild(messageTemplateText);

                contentDiv.appendChild(document.createElement('hr'));
            });
        }

        async function fetchCurrentAlertingEvent(eventId) {
            const url = `https://sasserver.demo.sas.com/svi-alert/alertingEvents/${eventId}`;

            try {
                const response = await fetch(url, requestOptions);
                if (!response.ok) throw new Error('Network response was not ok ' + response.statusText);

                const result = await response.json();
                console.log('Current Alerting Event Details:', result);
                displayResponse('currentAlertingEventResponse', result);
            } catch (error) {
                console.error('There has been a problem with your fetch operation:', error);
            }
        }

        async function fetchTransactionDetails(actionableEntityId) {
            const url = `https://sasserver.demo.sas.com/amlCore/transactions?entityLevelCode=PTY&entityNumber=${actionableEntityId}`;

            try {
                const response = await fetch(url, requestOptions);
                if (!response.ok) throw new Error('Network response was not ok ' + response.statusText);

                const result = await response.json();
                console.log('Transaction Details:', result);
                displayResponse('transactionDetails', result);
            } catch (error) {
                console.error('There has been a problem with your fetch operation:', error);
            }
        }

        async function fetchPtyDetails(actionableEntityId) {
            const url = `https://sasserver.demo.sas.com/SASVisualInvestigator/pages/PTY/${actionableEntityId}`;

            try {
                const response = await fetch(url, requestOptions);
                if (!response.ok) throw new Error('Network response was not ok ' + response.statusText);

                const result = await response.json();
                console.log('PTY Details:', result);
                displayResponse('ptyDetails', result);
            } catch (error) {
                console.error('There has been a problem with your fetch operation:', error);
            }
        }

        // Initial fetch call
        fetchInitialApiResponse();
    </script>
</body>
</html>
